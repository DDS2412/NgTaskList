<clr-main-container>
  <app-header></app-header>
  <div class="btn-group btn-primary btn-sm btn-pos">
    <button class="btn" (click)="openModal('new-card-modal')"><clr-icon shape="plus"></clr-icon> Добавить</button>
    <button class="btn" (click)="onEdit()" *ngIf="selected.length == 1">
      <clr-icon shape="pencil"></clr-icon> Изменить
    </button>
    <button class="btn btn-danger" (click)="onDelete()" *ngIf="selected.length > 0">
      <clr-icon shape="close"></clr-icon> Удалить
    </button>
  </div>

  <clr-datagrid [(clrDgSelected)]="selected">
    <clr-dg-column [style.flex-grow]="1"
      >Созданно
      <clr-dg-string-filter [clrDgStringFilter]="creationDateFilter"></clr-dg-string-filter>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="'name'" [style.flex-grow]="1.5">Название</clr-dg-column>
    <clr-dg-column [style.flex-grow]="2"
      >Метки
      <clr-dg-string-filter [clrDgStringFilter]="labelFilter"></clr-dg-string-filter>
    </clr-dg-column>
    <clr-dg-column [style.flex-grow]="1"
      >Срок
      <clr-dg-string-filter [clrDgStringFilter]="deadlineFilter"></clr-dg-string-filter>
    </clr-dg-column>
    <clr-dg-column [style.flex-grow]="1"
      >Исполнители
      <clr-dg-string-filter [clrDgStringFilter]="assignedPersonFilter"></clr-dg-string-filter>
    </clr-dg-column>

    <clr-dg-row *clrDgItems="let card of cards" [clrDgItem]="card">
      <clr-dg-cell>{{ formatDate(card.actions[0].date) }}</clr-dg-cell>
      <clr-dg-cell [style.flex-grow]="1.5">{{ card.name }}</clr-dg-cell>
      <clr-dg-cell [style.flex-grow]="2">
        <span *ngFor="let label of card.labels" [style.background-color]="label.color" class="label label-info">
          {{ label.name }}
        </span>
      </clr-dg-cell>
      <clr-dg-cell>
        <ng-container [ngSwitch]="card.due == null">
          <span *ngSwitchCase="true">Не назначено</span>
          <span *ngSwitchCase="false">{{ formatDate(card.due) }}</span>
          <span *ngSwitchDefault>Не известно</span>
        </ng-container>
      </clr-dg-cell>
      <clr-dg-cell>
        <span *ngFor="let member of card.members; let i = index"
          >{{ member.fullName }}<span *ngIf="i != card.members.length - 1">, </span>
        </span>
      </clr-dg-cell>

      <clr-dg-row-detail *clrIfExpanded>
        {{ card.desc }}
      </clr-dg-row-detail>
    </clr-dg-row>

    <clr-dg-footer>
      <clr-dg-pagination #pagination [clrDgPageSize]="10">
        <clr-dg-page-size [clrPageSizeOptions]="[10, 20, 50, 100]">Users per page</clr-dg-page-size>
        {{ pagination.firstItem + 1 }} - {{ pagination.lastItem + 1 }} of {{ pagination.totalItems }} cards
      </clr-dg-pagination>
    </clr-dg-footer>
  </clr-datagrid>

  <app-modal-window id="new-card-modal">
    <app-new-card-modal-window [modalWindowName]="'new-card-modal'"></app-new-card-modal-window>
  </app-modal-window>
</clr-main-container>
